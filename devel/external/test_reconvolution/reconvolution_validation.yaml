# declare some variables used internally in config
some_variables:
    - &ngals_in_cat 276

# this are the parameters of the deep images, a mock catalog of the COSMOS sample
cosmos_images:
        
    gal :
        type : Sersic
        half_light_radius : { type : InputCatalog , col : 2 }
        n : { type : InputCatalog , col : 1 }
        ellip : 
            type : GBeta 
            g : { type : InputCatalog , col : 3 }  
            beta : { type: Rad , theta : {type : InputCatalog , col : 4 }}  
        shift : 
            type : XY  
            x : { type : InputCatalog , col : 5 }
            y : { type : InputCatalog , col : 6 }
        flux : 1e5

    # this is the PSF of the deep imaging
    psf : 
        type : Airy
        lam_over_diam : {type: Eval, str: '700.e-9 / 1.3 * 180. / math.pi * 3600.'}
        ellip : 
            type : EBeta
            e : { type : Random , min : 0.0 , max : 0.2 }
            beta : { type : Random }
      
    image :
        random_seed : 121212
        draw_method : fft
        nproc : 5
        pixel_scale : 0.03          # pixel scale for space observations
        type : Single
        # this has to be big in order for the space images to contain the galaxies fully
        size : 128
        # this field is required for the photon image, 
        # but we don't want to add any noise, so we set the variance to 0
        noise : { type : Gaussian, variance : 0. }
        
    input :
        catalog :
            dir : .
            file_name : cosmos_sersics_sample_N300_cleaned.asc
   
    # the image created will create a real_galaxy_images for real_galaxy_images_psf
    output :
        type : MultiFits
        nimages : *ngals_in_cat
        dir : .
        file_name : rgc_val_gal.fits          
        psf :
            file_name : rgc_val_psf.fits    

# this is 
reconvolved_images :
    # this is the reconvolving PSF
    psf : 
        type : Convolution
        items :  
            - { type : Moffat, fwhm : 0.65, beta : 3 }
            - { type : Airy, lam_over_diam : {type: Eval, str: '(700.e-9)/4*180/math.pi*3600'} }
        ellip : 
            type : EBeta
            e : { type : Random , min : 0.0 , max : 0.2 }
            beta : { type : Random }
            
    gal :
        type : RealGalaxy
        flux : 1.e5
        index : { type : Sequence }
        shear : 
            type : List
            items: 
                - { type : G1G2 , g1 : -0.027 , g2 :  0.031 }
                - { type : G1G2 , g1 : +0.015 , g2 : -0.015 }
              
    image :
        random_seed : 2222211
        nproc : 5
        pixel_scale : 0.2   # pixel scale for the ground observation
        type : Tiled
        nx_tiles : 1        # we are generating galaxies in one long tiled stripe
        ny_tiles : *ngals_in_cat    
        stamp_size : 128    #  big in order for the space images to contain the galaxies fully
        # this field is required for the photon image, 
        # but we don't want to add any noise, so we set the variance to 0
        noise : { type : Gaussian, sigma : 0. }
    
    input:
        real_catalog :
            dir : .
            file_name : rgc_val.fits     # will be created by the script
            preload : True   

gsparams :  # although outside here, the script will take care of it
    minimum_fft_size : 128      
    maximum_fft_size : 50000     
    alias_threshold : 5.e-3     
    maxk_threshold : 1.e-3      
    kvalue_accuracy : 1.e-5     
    xvalue_accuracy : 1.e-5     
    shoot_accuracy : 1.e-5      
    realspace_relerr : 1.e-3    
    realspace_abserr : 1.e-6    
    integration_relerr : 1.e-5  
    integration_abserr : 1.e-7  

vary_params:
    alias_threshold : 
        path : ['image','gsparams','alias_threshold']
        values : [ 1.0e-1 , 5.0e-2 , 1.0e-2 , 5.0e-3 , 1.0e-3 , 5.0e-4 ]
        rebuild_direct : False 
        rebuild_reconv : True  
    maxk_threshold :   
        path : ['image','gsparams','maxk_threshold' ] 
        values : [ 1.0e-1 , 1.0e-2 , 5.0e-3 , 1.0e-3 , 5.0e-4 , 1.0e-4 , 5.0e-5 , 1.0e-5 ]  
        rebuild_direct : False
        rebuild_reconv : True 
    kvalue_accuracy : 
        path : ['image','gsparams','kvalue_accuracy']
        values : [ 1.0e-3 , 1.0e-4 , 1.0e-5 , 1.0e-6 , 1.0e-7 , 1.0e-8 ] 
        rebuild_direct : False 
        rebuild_reconv : True 



