<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<title>GalSim: galsim.psfcorr Namespace Reference</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/search.js"></script>
<script type="text/javascript">
  $(document).ready(function() { searchBox.OnSelectItem(0); });
</script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td id="projectlogo"><img alt="Logo" src="logo.png"/></td>
  <td style="padding-left: 0.5em;">
   <div id="projectname">GalSim
   &#160;<span id="projectnumber">0.1</span>
   </div>
   <div id="projectbrief">Simulating galaxy images for weak lensing system testing</div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.8.1 -->
<script type="text/javascript">
var searchBox = new SearchBox("searchBox", "search",false,'Search');
</script>
  <div id="navrow1" class="tabs">
    <ul class="tablist">
      <li><a href="index.html"><span>Main&#160;Page</span></a></li>
      <li class="current"><a href="namespaces.html"><span>Packages</span></a></li>
      <li><a href="annotated.html"><span>Classes</span></a></li>
      <li><a href="files.html"><span>Files</span></a></li>
      <li>
        <div id="MSearchBox" class="MSearchBoxInactive">
        <span class="left">
          <img id="MSearchSelect" src="search/mag_sel.png"
               onmouseover="return searchBox.OnSearchSelectShow()"
               onmouseout="return searchBox.OnSearchSelectHide()"
               alt=""/>
          <input type="text" id="MSearchField" value="Search" accesskey="S"
               onfocus="searchBox.OnSearchFieldFocus(true)" 
               onblur="searchBox.OnSearchFieldFocus(false)" 
               onkeyup="searchBox.OnSearchFieldChange(event)"/>
          </span><span class="right">
            <a id="MSearchClose" href="javascript:searchBox.CloseResultsWindow()"><img id="MSearchCloseImg" border="0" src="search/close.png" alt=""/></a>
          </span>
        </div>
      </li>
    </ul>
  </div>
  <div id="navrow2" class="tabs2">
    <ul class="tablist">
      <li><a href="namespaces.html"><span>Packages</span></a></li>
      <li><a href="namespacemembers.html"><span>Package&#160;Functions</span></a></li>
    </ul>
  </div>
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
<a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(0)"><span class="SelectionMark">&#160;</span>All</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(1)"><span class="SelectionMark">&#160;</span>Classes</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(2)"><span class="SelectionMark">&#160;</span>Namespaces</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(3)"><span class="SelectionMark">&#160;</span>Files</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(4)"><span class="SelectionMark">&#160;</span>Functions</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(5)"><span class="SelectionMark">&#160;</span>Variables</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(6)"><span class="SelectionMark">&#160;</span>Typedefs</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(7)"><span class="SelectionMark">&#160;</span>Enumerations</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(8)"><span class="SelectionMark">&#160;</span>Enumerator</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(9)"><span class="SelectionMark">&#160;</span>Properties</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(10)"><span class="SelectionMark">&#160;</span>Friends</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(11)"><span class="SelectionMark">&#160;</span>Macros</a></div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

<div id="nav-path" class="navpath">
  <ul>
<li class="navelem"><a class="el" href="namespacegalsim.html">galsim</a></li><li class="navelem"><a class="el" href="namespacegalsim_1_1psfcorr.html">psfcorr</a></li>  </ul>
</div>
</div><!-- top -->
<div class="header">
  <div class="summary">
<a href="#func-members">Functions</a>  </div>
  <div class="headertitle">
<div class="title">galsim.psfcorr Namespace Reference</div>  </div>
</div><!--header-->
<div class="contents">
<table class="memberdecls">
<tr class="heading"><td colspan="2"><h2><a name="func-members"></a>
Functions</h2></td></tr>
<tr class="memitem:a1072476270c2dcd1b1223fcb41e2bda5"><td class="memItemLeft" align="right" valign="top">def&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="namespacegalsim_1_1psfcorr.html#a1072476270c2dcd1b1223fcb41e2bda5">EstimateShearHSM</a></td></tr>
<tr class="memdesc:a1072476270c2dcd1b1223fcb41e2bda5"><td class="mdescLeft">&#160;</td><td class="mdescRight">PSF correction method from HSM.  <a href="#a1072476270c2dcd1b1223fcb41e2bda5"></a><br/></td></tr>
<tr class="memitem:a618f9583532b5e8e2cc6d7e073369e8b"><td class="memItemLeft" align="right" valign="top">def&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="namespacegalsim_1_1psfcorr.html#a618f9583532b5e8e2cc6d7e073369e8b">FindAdaptiveMom</a></td></tr>
<tr class="memdesc:a618f9583532b5e8e2cc6d7e073369e8b"><td class="mdescLeft">&#160;</td><td class="mdescRight">Measure adaptive moments of an object.  <a href="#a618f9583532b5e8e2cc6d7e073369e8b"></a><br/></td></tr>
</table>
<hr/><h2>Function Documentation</h2>
<a class="anchor" id="a1072476270c2dcd1b1223fcb41e2bda5"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">def galsim.psfcorr.EstimateShearHSM </td>
          <td>(</td>
          <td class="paramtype">&#160;</td>
          <td class="paramname"><em>gal_image</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">&#160;</td>
          <td class="paramname"><em>PSF_image</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">&#160;</td>
          <td class="paramname"><em>sky_var</em> = <code>0.0</code>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">&#160;</td>
          <td class="paramname"><em>shear_est</em> = <code>&quot;REGAUSS&quot;</code>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">&#160;</td>
          <td class="paramname"><em>flags</em> = <code>0xe</code>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">&#160;</td>
          <td class="paramname"><em>guess_sig_gal</em> = <code>5.0</code>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">&#160;</td>
          <td class="paramname"><em>guess_sig_PSF</em> = <code>3.0</code>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">&#160;</td>
          <td class="paramname"><em>precision</em> = <code>1.0e-6</code>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">&#160;</td>
          <td class="paramname"><em>guess_x_centroid</em> = <code>-1000.0</code>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">&#160;</td>
          <td class="paramname"><em>guess_y_centroid</em> = <code>-1000.0</code>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">&#160;</td>
          <td class="paramname"><em>strict</em> = <code>True</code>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>PSF correction method from HSM. </p>
<pre class="fragment">Carry out PSF correction using one of the methods of the HSM package to estimate shears.
Example usage:
</pre><div class="fragment"><div class="line">     galaxy = <a class="code" href="classgalsim_1_1base_1_1_gaussian.html" title="GalSim Gaussian, which has an SBGaussian in the SBProfile attribute.">galsim.Gaussian</a>(flux = 1.0, sigma = 1.0)</div>
<div class="line">     galaxy.applyShear(g1=0.05, g2=0.0)  <span class="comment"># shear it by (0.05, 0) using the g=(a-b)/(a+b) definition</span></div>
<div class="line">     psf = <a class="code" href="classgalsim_1_1atmosphere_1_1_double_gaussian.html" title="Double Gaussian, which is the sum of two SBProfile Gaussian profiles.">galsim.atmosphere.DoubleGaussian</a>(flux1 = 0.7, sigma1 = 0.7, flux2 = 0.3, sigma2 = 1.5)</div>
<div class="line">     pixel = <a class="code" href="classgalsim_1_1base_1_1_pixel.html" title="GalSim Pixel, which has an SBBox in the SBProfile attribute.">galsim.Pixel</a>(xw = 0.2, yw = 0.2)</div>
<div class="line">     final = <a class="code" href="classgalsim_1_1base_1_1_convolve.html" title="A class for convolving 2 or more GSObjects.">galsim.Convolve</a>([galaxy, psf, pixel])</div>
<div class="line">     final_epsf = <a class="code" href="classgalsim_1_1base_1_1_convolve.html" title="A class for convolving 2 or more GSObjects.">galsim.Convolve</a>([psf, pixel])</div>
<div class="line">     final_image = final.draw(dx = 0.2)</div>
<div class="line">     final_epsf_image = final_epsf.draw(dx = 0.2)</div>
<div class="line">     result = galsim.EstimateShearHSM(final_image, final_epsf_image)</div>
</div><!-- fragment --><p>After running the above code, result.observed_shape ["shape" = distortion, (a^2-b^2)/(a^2+b^2)] is (0.0595676, 0), and result.corrected_shape is (0.0981158, 0), compared with the expected (0.09975, 0) for a perfect PSF correction method. Note that the method will fail if the PSF or galaxy are too point-like to easily fit an elliptical Gaussian; when running on batches of many galaxies, it may be preferable to set strict=False and catch errors explicitly, i.e.</p>
<div class="fragment"><div class="line">     n_image = 100</div>
<div class="line">     n_fail = 0</div>
<div class="line">     <span class="keywordflow">for</span> i=0, range(n_image):</div>
<div class="line">         ...some code defining this_image, this_final_epsf_image...</div>
<div class="line">         result = galsim.EstimateShearHSM(this_image, this_final_epsf_image, strict = <span class="keyword">False</span>)</div>
<div class="line">         <span class="keywordflow">if</span> result.error_message != <span class="stringliteral">&quot;&quot;</span>:</div>
<div class="line">             n_fail += 1</div>
<div class="line">     <span class="keywordflow">print</span> <span class="stringliteral">&quot;Number of failures: &quot;</span>, n_fail</div>
</div><!-- fragment --><h2>Parameters</h2>
<dl class="params"><dt>Parameters:</dt><dd>
  <table class="params">
    <tr><td class="paramdir">[in]</td><td class="paramname">gal_image</td><td>The <a class="el" href="classgalsim_1_1_image.html" title="Image class.">Image</a> or <a class="el" href="classgalsim_1_1_image_view.html" title="ImageView class is a mutable view of an Image.">ImageView</a> of the galaxy being measured. </td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">PSF_image</td><td>The <a class="el" href="classgalsim_1_1_image.html" title="Image class.">Image</a> or <a class="el" href="classgalsim_1_1_image_view.html" title="ImageView class is a mutable view of an Image.">ImageView</a> for the PSF </td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">sky_var</td><td>The variance of the sky level, used for estimating uncertainty on the measured shape; default 0. </td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">*shear_est</td><td>A string indicating the desired method of PSF correction: REGAUSS, LINEAR, BJ, or KSB; default REGAUSS. </td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">flags</td><td>A flag determining various aspects of the shape measurement process (only necessary for REGAUSS); default 0xe. </td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">guess_sig_gal</td><td>Optional argument with an initial guess for the Gaussian sigma of the galaxy, default 5.0 (pixels). </td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">guess_sig_PSF</td><td>Optional argument with an initial guess for the Gaussian sigma of the PSF, default 3.0 (pixels). </td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">precision</td><td>The convergence criterion for the moments; default 1e-6. </td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">guess_x_centroid</td><td>An initial guess for the x component of the object centroid (useful in case it is not located at the center, which is the default assumption). </td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">guess_y_centroid</td><td>An initial guess for the y component of the object centroid (useful in case it is not located at the center, which is the default assumption). </td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">strict</td><td>If True (default), then there will be a run-time exception if shear estimation fails. If set to False, then information about failures will be silently stored in the output HSMShapeData object. </td></tr>
  </table>
  </dd>
</dl>
<dl class="section return"><dt>Returns:</dt><dd>A HSMShapeData object containing the results of shape measurement. </dd></dl>

</div>
</div>
<a class="anchor" id="a618f9583532b5e8e2cc6d7e073369e8b"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">def galsim.psfcorr.FindAdaptiveMom </td>
          <td>(</td>
          <td class="paramtype">&#160;</td>
          <td class="paramname"><em>object_image</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">&#160;</td>
          <td class="paramname"><em>guess_sig</em> = <code>5.0</code>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">&#160;</td>
          <td class="paramname"><em>precision</em> = <code>1.0e-6</code>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">&#160;</td>
          <td class="paramname"><em>guess_x_centroid</em> = <code>-1000.0</code>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">&#160;</td>
          <td class="paramname"><em>guess_y_centroid</em> = <code>-1000.0</code>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">&#160;</td>
          <td class="paramname"><em>strict</em> = <code>True</code>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Measure adaptive moments of an object. </p>
<pre class="fragment">The key result is the best-fit elliptical Gaussian to the object, which is computed iteratively
by initially guessing a circular Gaussian that is used as a weight function, computing the
weighted moments, recomputing the moments using the result of the previous step as the weight
function, and so on until the moments that are measured are the same as those used for the
weight function.  FindAdaptiveMom can be used either as a free function, or as a method of the
ImageView class.  Example usage:
</pre><div class="fragment"><div class="line">     my_gaussian = <a class="code" href="classgalsim_1_1base_1_1_gaussian.html" title="GalSim Gaussian, which has an SBGaussian in the SBProfile attribute.">galsim.Gaussian</a>(flux = 1.0, sigma = 1.0)</div>
<div class="line">     my_gaussian_image = my_gaussian.draw(dx = 0.2)</div>
<div class="line">     my_moments = galsim.FindAdaptiveMom(my_gaussian_image)</div>
</div><!-- fragment --><p>OR</p>
<div class="fragment"><div class="line">     my_moments = my_gaussian_image.FindAdaptiveMom()</div>
</div><!-- fragment --><p>Assuming a successful measurement, the most relevant pieces of information are my_moments.moments_sigma, which is |det(M)|^(1/4) [=sigma for a circular Gaussian] and my_moments.observed_shape, which is a C++ <a class="el" href="classgalsim_1_1_shear.html" title="A base class representing shears.">Shear</a>. Methods of the <a class="el" href="classgalsim_1_1_shear.html" title="A base class representing shears.">Shear</a> class can be used to get the distortion (e1, e2) = (a^2-b^2)/(a^2+b^2), i.e. my_moments.observed_shape.getE1() &ndash; or, to get the shear g, the conformal shear eta, and so on.</p>
<p>Note that the method will fail if the object is too point-like to easily fit an elliptical Gaussian; when running on batches of many galaxies, it may be preferable to set strict=False and catch errors explicitly, i.e.</p>
<div class="fragment"><div class="line">     n_image = 100</div>
<div class="line">     n_fail = 0</div>
<div class="line">     <span class="keywordflow">for</span> i=0, range(n_image):</div>
<div class="line">         ...some code defining this_image <span class="keywordflow">for</span> index i...</div>
<div class="line">         result = this_image.FindAdaptiveMom(strict = <span class="keyword">False</span>)</div>
<div class="line">         <span class="keywordflow">if</span> result.error_message != <span class="stringliteral">&quot;&quot;</span>:</div>
<div class="line">             n_fail += 1</div>
<div class="line">     <span class="keywordflow">print</span> <span class="stringliteral">&quot;Number of failures: &quot;</span>, n_fail</div>
</div><!-- fragment --><dl class="params"><dt>Parameters:</dt><dd>
  <table class="params">
    <tr><td class="paramdir">[in]</td><td class="paramname">object_image</td><td>The <a class="el" href="classgalsim_1_1_image.html" title="Image class.">Image</a> or <a class="el" href="classgalsim_1_1_image_view.html" title="ImageView class is a mutable view of an Image.">ImageView</a> for the object being measured. </td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">guess_sig</td><td>Optional argument with an initial guess for the Gaussian sigma of the object, default 5.0 (pixels). </td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">precision</td><td>The convergence criterion for the moments; default 1e-6. </td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">guess_x_centroid</td><td>An initial guess for the x component of the object centroid (useful in case it is not located at the center, which is the default assumption). </td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">guess_y_centroid</td><td>An initial guess for the y component of the object centroid (useful in case it is not located at the center, which is the default assumption). </td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">strict</td><td>If True (default), then there will be a run-time exception when moment measurement fails. If set to False, then information about failures will be silently stored in the output HSMShapeData object. </td></tr>
  </table>
  </dd>
</dl>
<dl class="section return"><dt>Returns:</dt><dd>A HSMShapeData object containing the results of moment measurement. </dd></dl>

</div>
</div>
</div><!-- contents -->
<!-- start footer part -->
<hr class="footer"/><address class="footer"><small>
Generated on Wed Jun 20 2012 19:06:25 for GalSim by &#160;<a href="http://www.doxygen.org/index.html">
<img class="footer" src="doxygen.png" alt="doxygen"/>
</a> 1.8.1
</small></address>
</body>
</html>
