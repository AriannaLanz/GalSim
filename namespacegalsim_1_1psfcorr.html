<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<title>GalSim: galsim.psfcorr Namespace Reference</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/search.js"></script>
<script type="text/javascript">
  $(document).ready(function() { searchBox.OnSelectItem(0); });
</script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td id="projectlogo"><img alt="Logo" src="logo.png"/></td>
  <td style="padding-left: 0.5em;">
   <div id="projectname">GalSim
   &#160;<span id="projectnumber">0.1</span>
   </div>
   <div id="projectbrief">The modular galaxy image simulation toolkit</div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.8.1 -->
<script type="text/javascript">
var searchBox = new SearchBox("searchBox", "search",false,'Search');
</script>
  <div id="navrow1" class="tabs">
    <ul class="tablist">
      <li><a href="index.html"><span>Main&#160;Page</span></a></li>
      <li><a href="pages.html"><span>Related&#160;Pages</span></a></li>
      <li class="current"><a href="namespaces.html"><span>Packages</span></a></li>
      <li><a href="annotated.html"><span>Classes</span></a></li>
      <li><a href="files.html"><span>Files</span></a></li>
      <li>
        <div id="MSearchBox" class="MSearchBoxInactive">
        <span class="left">
          <img id="MSearchSelect" src="search/mag_sel.png"
               onmouseover="return searchBox.OnSearchSelectShow()"
               onmouseout="return searchBox.OnSearchSelectHide()"
               alt=""/>
          <input type="text" id="MSearchField" value="Search" accesskey="S"
               onfocus="searchBox.OnSearchFieldFocus(true)" 
               onblur="searchBox.OnSearchFieldFocus(false)" 
               onkeyup="searchBox.OnSearchFieldChange(event)"/>
          </span><span class="right">
            <a id="MSearchClose" href="javascript:searchBox.CloseResultsWindow()"><img id="MSearchCloseImg" border="0" src="search/close.png" alt=""/></a>
          </span>
        </div>
      </li>
    </ul>
  </div>
  <div id="navrow2" class="tabs2">
    <ul class="tablist">
      <li><a href="namespaces.html"><span>Packages</span></a></li>
      <li><a href="namespacemembers.html"><span>Package&#160;Functions</span></a></li>
    </ul>
  </div>
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
<a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(0)"><span class="SelectionMark">&#160;</span>All</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(1)"><span class="SelectionMark">&#160;</span>Classes</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(2)"><span class="SelectionMark">&#160;</span>Namespaces</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(3)"><span class="SelectionMark">&#160;</span>Files</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(4)"><span class="SelectionMark">&#160;</span>Functions</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(5)"><span class="SelectionMark">&#160;</span>Variables</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(6)"><span class="SelectionMark">&#160;</span>Typedefs</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(7)"><span class="SelectionMark">&#160;</span>Enumerations</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(8)"><span class="SelectionMark">&#160;</span>Enumerator</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(9)"><span class="SelectionMark">&#160;</span>Properties</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(10)"><span class="SelectionMark">&#160;</span>Friends</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(11)"><span class="SelectionMark">&#160;</span>Macros</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(12)"><span class="SelectionMark">&#160;</span>Pages</a></div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

<div id="nav-path" class="navpath">
  <ul>
<li class="navelem"><a class="el" href="namespacegalsim.html">galsim</a></li><li class="navelem"><a class="el" href="namespacegalsim_1_1psfcorr.html">psfcorr</a></li>  </ul>
</div>
</div><!-- top -->
<div class="header">
  <div class="summary">
<a href="#nested-classes">Classes</a> &#124;
<a href="#func-members">Functions</a>  </div>
  <div class="headertitle">
<div class="title">galsim.psfcorr Namespace Reference</div>  </div>
</div><!--header-->
<div class="contents">
<table class="memberdecls">
<tr class="heading"><td colspan="2"><h2><a name="nested-classes"></a>
Classes</h2></td></tr>
<tr class="memitem:"><td class="memItemLeft" align="right" valign="top">class &#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classgalsim_1_1psfcorr_1_1_h_s_m_shape_data.html">HSMShapeData</a></td></tr>
<tr class="memdesc:"><td class="mdescLeft">&#160;</td><td class="mdescRight">A class to contain the outputs of using the HSM shape and moments measurement routines.  <a href="classgalsim_1_1psfcorr_1_1_h_s_m_shape_data.html#details">More...</a><br/></td></tr>
</table><table class="memberdecls">
<tr class="heading"><td colspan="2"><h2><a name="func-members"></a>
Functions</h2></td></tr>
<tr class="memitem:a1072476270c2dcd1b1223fcb41e2bda5"><td class="memItemLeft" align="right" valign="top">def&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="namespacegalsim_1_1psfcorr.html#a1072476270c2dcd1b1223fcb41e2bda5">EstimateShearHSM</a></td></tr>
<tr class="memdesc:a1072476270c2dcd1b1223fcb41e2bda5"><td class="mdescLeft">&#160;</td><td class="mdescRight">Carry out moments-based PSF correction routines.  <a href="#a1072476270c2dcd1b1223fcb41e2bda5"></a><br/></td></tr>
<tr class="memitem:a618f9583532b5e8e2cc6d7e073369e8b"><td class="memItemLeft" align="right" valign="top">def&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="namespacegalsim_1_1psfcorr.html#a618f9583532b5e8e2cc6d7e073369e8b">FindAdaptiveMom</a></td></tr>
<tr class="memdesc:a618f9583532b5e8e2cc6d7e073369e8b"><td class="mdescLeft">&#160;</td><td class="mdescRight">Measure adaptive moments of an object.  <a href="#a618f9583532b5e8e2cc6d7e073369e8b"></a><br/></td></tr>
</table>
<hr/><h2>Function Documentation</h2>
<a class="anchor" id="a1072476270c2dcd1b1223fcb41e2bda5"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">def galsim.psfcorr.EstimateShearHSM </td>
          <td>(</td>
          <td class="paramtype">&#160;</td>
          <td class="paramname"><em>gal_image</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">&#160;</td>
          <td class="paramname"><em>PSF_image</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">&#160;</td>
          <td class="paramname"><em>sky_var</em> = <code>0.0</code>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">&#160;</td>
          <td class="paramname"><em>shear_est</em> = <code>&quot;REGAUSS&quot;</code>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">&#160;</td>
          <td class="paramname"><em>flags</em> = <code>0xe</code>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">&#160;</td>
          <td class="paramname"><em>guess_sig_gal</em> = <code>5.0</code>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">&#160;</td>
          <td class="paramname"><em>guess_sig_PSF</em> = <code>3.0</code>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">&#160;</td>
          <td class="paramname"><em>precision</em> = <code>1.0e-6</code>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">&#160;</td>
          <td class="paramname"><em>guess_x_centroid</em> = <code>-1000.0</code>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">&#160;</td>
          <td class="paramname"><em>guess_y_centroid</em> = <code>-1000.0</code>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">&#160;</td>
          <td class="paramname"><em>strict</em> = <code>True</code>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Carry out moments-based PSF correction routines. </p>
<p>Carry out PSF correction using one of the methods of the HSM package (see references in docstring for file <a class="el" href="psfcorr_8py.html" title="Routines for adaptive moment estimation and PSF correction.">psfcorr.py</a>) to estimate galaxy shears, correcting for the convolution by the PSF.</p>
<p>This method works from <a class="el" href="classgalsim_1_1_image.html" title="Image class.">Image</a> inputs rather than <a class="el" href="classgalsim_1_1base_1_1_g_s_object.html" title="Base class for defining the interface with which all GalSim Objects access their shared methods and a...">galsim.base.GSObject</a> inputs, which provides additional flexibility (e.g., it is possible to work from an <a class="el" href="classgalsim_1_1_image.html" title="Image class.">Image</a> that was read from file and corresponds to no particular GSObject), but this also means that users who wish to apply it to simple combinations of GSObjects (e.g., a Convolve) must take the additional step of drawing their GSObjects into Images.</p>
<p>Note that the method will fail if the PSF or galaxy are too point-like to easily fit an elliptical Gaussian; when running on batches of many galaxies, it may be preferable to set <code>strict=False</code> and catch errors explicitly, as in the second example below.</p>
<p>This function has a number of keyword parameters, many of which a typical user will not need to change from the default.</p>
<h2>Example usage</h2>
<p>Typical application to a single object: </p>
<pre class="fragment">&gt;&gt;&gt; galaxy = galsim.Gaussian(flux = 1.0, sigma = 1.0)
&gt;&gt;&gt; galaxy.applyShear(g1=0.05, g2=0.0)  # shears the Gaussian by (0.05, 0) using the 
                                        # |g| = (a - b)/(a + b) definition
&gt;&gt;&gt; psf = galsim.Kolmogorov(flux = 1.0, fwhm = 0.7)
&gt;&gt;&gt; pixel = galsim.Pixel(xw = 0.2, yw = 0.2)
&gt;&gt;&gt; final = galsim.Convolve([galaxy, psf, pixel])
&gt;&gt;&gt; final_epsf = galsim.Convolve([psf, pixel])
&gt;&gt;&gt; final_image = final.draw(dx = 0.2)
&gt;&gt;&gt; final_epsf_image = final_epsf.draw(dx = 0.2)
&gt;&gt;&gt; result = galsim.EstimateShearHSM(final_image, final_epsf_image)
</pre><p>After running the above code, <code>result.observed_shape</code> ["shape" = distortion, the (a^2 - b^2)/(a^2 + b^2) definition of ellipticity] is <code>(0.0876162,1.23478e-17)</code> and <code>result.corrected_shape</code> is <code>(0.0993412,-1.86255e-09)</code>, compared with the expected <code>(0.09975, 0)</code> for a perfect PSF correction method.</p>
<p>The code below gives an example of how one could run this routine on a large batch of galaxies, explicitly catching and tracking any failures: </p>
<pre class="fragment">n_image = 100
n_fail = 0
for i=0, range(n_image):
    #...some code defining this_image, this_final_epsf_image...
    result = galsim.EstimateShearHSM(this_image, this_final_epsf_image, strict = False)
    if result.error_message != "":
        n_fail += 1
print "Number of failures: ", n_fail
</pre><dl class="params"><dt>Parameters:</dt><dd>
  <table class="params">
    <tr><td class="paramname">gal_image</td><td>The <a class="el" href="classgalsim_1_1_image.html" title="Image class.">Image</a> or <a class="el" href="classgalsim_1_1_image_view.html" title="ImageView class is a mutable view of an Image.">ImageView</a> of the galaxy being measured. </td></tr>
    <tr><td class="paramname">PSF_image</td><td>The <a class="el" href="classgalsim_1_1_image.html" title="Image class.">Image</a> or <a class="el" href="classgalsim_1_1_image_view.html" title="ImageView class is a mutable view of an Image.">ImageView</a> for the PSF. </td></tr>
    <tr><td class="paramname">sky_var</td><td>The variance of the sky level, used for estimating uncertainty on the measured shape; default <code>sky_var = 0.</code>. </td></tr>
    <tr><td class="paramname">shear_est</td><td>A string indicating the desired method of PSF correction: REGAUSS, LINEAR, BJ, or KSB; default <code>shear_est = "REGAUSS"</code>. </td></tr>
    <tr><td class="paramname">flags</td><td>A flag determining various aspects of the shape measurement process (only necessary for REGAUSS); default <code>flags=0</code>. </td></tr>
    <tr><td class="paramname">guess_sig_gal</td><td>Optional argument with an initial guess for the Gaussian sigma of the galaxy, default <code>guess_sig_gal = 5.</code> (pixels). </td></tr>
    <tr><td class="paramname">guess_sig_PSF</td><td>Optional argument with an initial guess for the Gaussian sigma of the PSF, default <code>guess_sig_PSF = 3.</code> (pixels). </td></tr>
    <tr><td class="paramname">precision</td><td>The convergence criterion for the moments; default <code>precision = 1e-6</code>. </td></tr>
    <tr><td class="paramname">guess_x_centroid</td><td>An initial guess for the x component of the object centroid (useful in case it is not located at the center, which is the default assumption). </td></tr>
    <tr><td class="paramname">guess_y_centroid</td><td>An initial guess for the y component of the object centroid (useful in case it is not located at the center, which is the default assumption). </td></tr>
    <tr><td class="paramname">strict</td><td>If <code>strict = True</code> (default), then there will be a <code>RuntimeError</code> exception if shear estimation fails. If set to <code>False</code>, then information about failures will be silently stored in the output <a class="el" href="classgalsim_1_1psfcorr_1_1_h_s_m_shape_data.html" title="A class to contain the outputs of using the HSM shape and moments measurement routines.">HSMShapeData</a> object. </td></tr>
  </table>
  </dd>
</dl>
<dl class="section return"><dt>Returns:</dt><dd>A <a class="el" href="classgalsim_1_1psfcorr_1_1_h_s_m_shape_data.html" title="A class to contain the outputs of using the HSM shape and moments measurement routines.">HSMShapeData</a> object containing the results of shape measurement. </dd></dl>

</div>
</div>
<a class="anchor" id="a618f9583532b5e8e2cc6d7e073369e8b"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">def galsim.psfcorr.FindAdaptiveMom </td>
          <td>(</td>
          <td class="paramtype">&#160;</td>
          <td class="paramname"><em>object_image</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">&#160;</td>
          <td class="paramname"><em>guess_sig</em> = <code>5.0</code>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">&#160;</td>
          <td class="paramname"><em>precision</em> = <code>1.0e-6</code>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">&#160;</td>
          <td class="paramname"><em>guess_x_centroid</em> = <code>-1000.0</code>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">&#160;</td>
          <td class="paramname"><em>guess_y_centroid</em> = <code>-1000.0</code>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">&#160;</td>
          <td class="paramname"><em>strict</em> = <code>True</code>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Measure adaptive moments of an object. </p>
<p>This method estimates the best-fit elliptical Gaussian to the object (see Hirata &amp; Seljak 2003 for more discussion of adaptive moments). This elliptical Gaussian is computed iteratively by initially guessing a circular Gaussian that is used as a weight function, computing the weighted moments, recomputing the moments using the result of the previous step as the weight function, and so on until the moments that are measured are the same as those used for the weight function. FindAdaptiveMom can be used either as a free function, or as a method of the ImageViewI(), ImageViewD() etc. classes.</p>
<p>Like EstimateShearHSM, FindAdaptiveMom works on <a class="el" href="classgalsim_1_1_image.html" title="Image class.">Image</a> inputs, and fails if the object is small compared to the pixel scale. For more details, see galsim.EstimateShearHSM (for doxygen documentation, see <a class="el" href="namespacegalsim_1_1psfcorr.html#a1072476270c2dcd1b1223fcb41e2bda5" title="Carry out moments-based PSF correction routines.">galsim.psfcorr.EstimateShearHSM</a>).</p>
<h2>Example usage</h2>
<pre class="fragment">&gt;&gt;&gt; my_gaussian = galsim.Gaussian(flux = 1.0, sigma = 1.0)
&gt;&gt;&gt; my_gaussian_image = my_gaussian.draw(dx = 0.2)
&gt;&gt;&gt; my_moments = galsim.FindAdaptiveMom(my_gaussian_image)
</pre><p>OR </p>
<pre class="fragment">&gt;&gt;&gt; my_moments = my_gaussian_image.FindAdaptiveMom()
</pre><p>Assuming a successful measurement, the most relevant pieces of information are <code>my_moments.moments_sigma</code>, which is <code>|det(M)|^(1/4)</code> [=<code>sigma</code> for a circular Gaussian] and <code>my_moments.observed_shape</code>, which is a C++ <a class="el" href="classgalsim_1_1_cpp_shear.html" title="A base class representing shears.">CppShear</a>.</p>
<p>Methods of the <a class="el" href="classgalsim_1_1_cpp_shear.html" title="A base class representing shears.">CppShear</a> class can be used to get the distortion <code>(e1, e2) = (a^2 - b^2)/(a^2 + b^2)</code>, e.g. <code>my_moments.observed_shape.getE1()</code>, or to get the shear <code>g</code>, the conformal shear <code>eta</code>, and so on.</p>
<dl class="params"><dt>Parameters:</dt><dd>
  <table class="params">
    <tr><td class="paramname">object_image</td><td>The <a class="el" href="classgalsim_1_1_image.html" title="Image class.">Image</a> or <a class="el" href="classgalsim_1_1_image_view.html" title="ImageView class is a mutable view of an Image.">ImageView</a> for the object being measured. </td></tr>
    <tr><td class="paramname">guess_sig</td><td>Optional argument with an initial guess for the Gaussian sigma of the object, default <code>guess_sig = 5.0</code> (pixels). </td></tr>
    <tr><td class="paramname">precision</td><td>The convergence criterion for the moments; default <code>precision = 1e-6</code>. </td></tr>
    <tr><td class="paramname">guess_x_centroid</td><td>An initial guess for the x component of the object centroid (useful in case it is not located at the center, which is the default assumption). </td></tr>
    <tr><td class="paramname">guess_y_centroid</td><td>An initial guess for the y component of the object centroid (useful in case it is not located at the center, which is the default assumption). </td></tr>
    <tr><td class="paramname">strict</td><td>If <code>strict = True</code> (default), then there will be a <code>RuntimeError</code> exception when moment measurement fails. If set to <code>False</code>, then information about failures will be silently stored in the output <a class="el" href="classgalsim_1_1psfcorr_1_1_h_s_m_shape_data.html" title="A class to contain the outputs of using the HSM shape and moments measurement routines.">HSMShapeData</a> object. </td></tr>
  </table>
  </dd>
</dl>
<dl class="section return"><dt>Returns:</dt><dd>A <a class="el" href="classgalsim_1_1psfcorr_1_1_h_s_m_shape_data.html" title="A class to contain the outputs of using the HSM shape and moments measurement routines.">HSMShapeData</a> object containing the results of moment measurement. </dd></dl>

</div>
</div>
</div><!-- contents -->
<hr class="footer"/><address class="footer"><small>
Generated for GalSim by&#160;<a href="http://www.doxygen.org/index.html"><img class="footer" src="doxygen.png" alt="doxygen"/></a> 1.8.1</small></address>
</body>
</html>
