\documentclass[preprint,11pt]{aastex}

% packages for figures
\usepackage{graphicx,times}
% packages for symbols
\usepackage{latexsym,amssymb,hyperref}
% AMS-LaTeX package for e.g. subequations
\usepackage{amsmath}

%=====================================================================
% FRONT MATTER
%=====================================================================

\slugcomment{Draft \today}

%=====================================================================
% BEGIN DOCUMENT
%=====================================================================

\newcommand{\gsobject}{{\tt GSObject}}
\newcommand{\image}{{\tt Image}}

\begin{document}

\setlength{\parskip}{2.0ex plus 0.5ex minus 0.5ex}
\setlength{\parindent}{0cm} 

\title{GalSim Library Quick Reference}

\section{Overview}

\emph{BARNEY TODO: Tidy this whole thing up, make it look a lot less ugly,
maybe use an entirely different document class.}

The GalSim Library provides a number of Python classes and methods for
simulating astronomical images.  The fundamental work flow will
normally be something like:
\begin{itemize}

\item Construct a representation of your desired astronomical object
  as a single GalSim \gsobject~instance or in combination using the
  special {\tt Add} and {\tt Convolve} compound-type \gsobject s ---
  see Section \ref{sect:gsobjects}.
\item \emph{Optional}: Apply transformations such as shear or
  magnification using the methods of the resulting \gsobject~instance
  --- see Section \ref{sect:gsobjectmethods}.
\item Draw the object into a GalSim \image~object representing a
  postage stamp image of your astronomical object.  This can be done
  using the {\tt draw()} or {\tt drawShoot()} methods carried by all
  \gsobject s for rendering images ({\tt drawShoot} uses photon
  shooting) --- see Section \ref{sect:gsobjectmethods}.
\item \emph{Optional}: Add noise to the \image~using one of the GalSim
  random deviate classes --- see Section \ref{sect:random}.
\item \emph{Optional}: Add the postage stamp \image~to a subsection of
  a larger \image~ instance, or to a larger structure containing
  multiple \image~instances each derived from \gsobject s as described
  above --- see Section \ref{sect:image}.
\item Save the \image (s) to file in FITS (Flexible Image Transport
  System) format --- see Section \ref{sect:image}.
\end{itemize}

There are many examples of this workflow in the directory {\tt
  GalSim/examples/}, showing most of the GalSim library in
action, in the scripts named
\texttt{demo1.py} -- \texttt{demo8.py}.  

We now provide a brief, reference description of the GalSim classes and methods which
can be used in this workflow.  Where possible this has been
hyperlinked to the online GalSim documentation generated by
\emph{doxygen} where a more detailed description can generally be found.

\newpage

%\section{GSObject classes and methods}
\section{The GSObjects}\label{sect:gsobjects}

There are currently 12 types of \gsobject. The first ten listed are
`simple' or `atomic' \gsobject s that can be initialized by providing
values for their required or optional parameters; the last two are
`compound' classes used to represent combinations of \gsobject s.  
They are summarized in the following hyperlinked list, 
in the order in which the classes appear in {\tt GalSim/galsim/base.py}:
\begin{itemize}
\item[$\circ$]
  \href{http://galsim-developers.github.com/GalSim/classgalsim_1_1base_1_1_gaussian.html}{\texttt{Gaussian}}
  --- \emph{a 2D Gaussian light profile.}
\item[$\circ$] \href{http://galsim-developers.github.com/GalSim/classgalsim_1_1base_1_1_moffat.html}{\texttt{Moffat}} --- \emph{a Moffat profile, used to approximate PSFs.}
\item[$\circ$] \href{http://galsim-developers.github.com/GalSim/classgalsim_1_1base_1_1_atmospheric_p_s_f.html}{\texttt{AtmosphericPSF}} --- \emph{currently an image-based
  implementation of a Kolmogorov PSF (see below), but expected to evolve to
  use an image of a stochastically modelled atmospheric PSF in the near future.}
\item[$\circ$] \href{http://galsim-developers.github.com/GalSim/classgalsim_1_1base_1_1_airy.html}{\texttt{Airy}} --- \emph{an Airy PSF for ideal diffraction
  through a circular aperture, supports central obscuration.}
\item[$\circ$] \href{http://galsim-developers.github.com/GalSim/classgalsim_1_1base_1_1_kolmogorov.html}{\texttt{Kolmogorov}} --- \emph{the Kolmogorov PSF for long-exposure
  images through a turbulent atmosphere.}
\item[$\circ$] \href{http://galsim-developers.github.com/GalSim/classgalsim_1_1base_1_1_optical_p_s_f.html}{\texttt{OpticalPSF}} --- \emph{a simple model for non-ideal
  (aberrated) propagation through circular or square apertures with obscuration.}
\item[$\circ$] \href{http://galsim-developers.github.com/GalSim/classgalsim_1_1base_1_1_pixel.html}{\texttt{Pixel}} --- \emph{used for integrating light onto square or
  rectangular pixels.}
\item[$\circ$] \href{http://galsim-developers.github.com/GalSim/classgalsim_1_1base_1_1_sersic.html}{\texttt{Sersic}} ---\emph{ the S\'{e}rsic family of galaxy light
  profiles.}
\item[$\circ$] \href{http://galsim-developers.github.com/GalSim/classgalsim_1_1base_1_1_exponential.html}{\texttt{Exponential}} --- \emph{the Exponential disc, a S\'{e}rsic
  with index $n=1$.}
\item[$\circ$] \href{http://galsim-developers.github.com/GalSim/classgalsim_1_1base_1_1_de_vaucouleurs.html}{\texttt{DeVaucouleurs}} --- \emph{commonly used to model galaxy bulge
  profiles, a S\'{e}rsic with index $n=4$.}
\item[$\circ$] \href{http://galsim-developers.github.com/GalSim/classgalsim_1_1base_1_1_real_galaxy.html}{\texttt{RealGalaxy}} --- \emph{models galaxies using real
  data, including a correction for the original PSF.  Requires the
  download of external data for full functionality.}
\item[$\circ$] \href{http://galsim-developers.github.com/GalSim/classgalsim_1_1base_1_1_add.html}{\texttt{Add}} --- \emph{a \emph{compound} object used for
  summing multiple \gsobject s.}
\item[$\circ$] \href{http://galsim-developers.github.com/GalSim/classgalsim_1_1base_1_1_convolve.html}{\texttt{Convolve}} --- \emph{a \emph{compound} object used for
convolving multiple \gsobject s.}
\end{itemize}

For more information and initialization details for each \gsobject,
the Python docstring for each class is available by typing

{\tt >>> print galsim.<GSObject\_name>.\_\_doc\_\_}

within the Python interpreter. Alternatively follow the hyperlinks on
the class names above to view the \emph{doxygen} documentation based
on the Python docstrings.

\section{Important GSObject methods}\label{sect:gsobjectmethods}
A number of methods are shared by all the \gsobject s~of Section
\ref{sect:gsobjects}, and are also to be found in \\ {\tt
  GalSim/galsim/base.py} within the definition of the \gsobject~base
class.  In what follows, we assume that a \gsobject~labelled
\texttt{obj} has been instantiated using one of the calls described in
the documentation linked above.  For example,

{\tt >>> obj = galsim.Sersic(n=3.5, half\_light\_radius=1.743)}.

Some of the most important and commonly-used methods for such an
instance are:
\begin{itemize}
\item[$\circ$]
  \href{http://galsim-developers.github.com/GalSim/classgalsim_1_1base_1_1_g_s_object.html#aa0b398d4b0fca70211e4a73f81ea7e1a}{\texttt{obj.copy()}}
  --- \emph{return a copy of the \gsobject.}
\item[$\circ$]
  \href{http://galsim-developers.github.com/GalSim/classgalsim_1_1base_1_1_g_s_object.html#a662d8ce421ecd90080bdcaaf6890aed8}{\texttt{obj.getFlux()}}
  --- \emph{get the flux of the \gsobject.}
\item[$\circ$]\href{http://galsim-developers.github.com/GalSim/classgalsim_1_1base_1_1_g_s_object.html#af4193645a9af52e7d54a044cafec8ab9}{\texttt{obj.scaleFlux(flux\_ratio)}}
  --- \emph{multiply the flux of the \gsobject~by \texttt{flux\_ratio}.}
\item[$\circ$]
  \href{http://galsim-developers.github.com/GalSim/classgalsim_1_1base_1_1_g_s_object.html#a1993652591ddc802b734186391b28894}{\texttt{obj.setFlux(flux)}}
    --- \emph{set the flux of the \gsobject~to \texttt{flux}.}
\item[$\circ$]
  \href{http://galsim-developers.github.com/GalSim/classgalsim_1_1base_1_1_g_s_object.html#a4301c73bbc1491ebb170e64c509cadd5}{\texttt{obj.applyDilation(scale)}}
  --- \emph{apply a dilation of the linear size of the \gsobject~by a
  factor \texttt{scale}.}
\item[$\circ$]
  \href{http://galsim-developers.github.com/GalSim/classgalsim_1_1base_1_1_g_s_object.html#a9d13b0238057f6d5d01f2681d91c09b0}{\texttt{obj.applyMagnification(scale)}}
  --- \emph{dilate linear size by \texttt{scale} and \gsobject~flux by
  \texttt{scale}$^2$, conserving surface brightness.}
\item[$\circ$]
  \href{http://galsim-developers.github.com/GalSim/classgalsim_1_1base_1_1_g_s_object.html#a85cc0094dcf470cfbff93d9830ab80bd}{\texttt{applyShear(*args,
      **kwargs)}}
  --- \emph{apply a shear to the \gsobject, handling a number of different
  input conventions.}
\item[$\circ$]
  \href{http://galsim-developers.github.com/GalSim/classgalsim_1_1base_1_1_g_s_object.html#ad6236e3153f23f1201396369dd67f1c7}{\texttt{obj.applyRotation(theta)}}
  --- \emph{apply a rotation of \texttt{theta} (positive direction
  anti-clockwise) to the \gsobject, where \texttt{theta} is a
  \texttt{galsim.Angle} instance (see Section \ref{sect:misc}). }
\item[$\circ$]
  \href{http://galsim-developers.github.com/GalSim/classgalsim_1_1base_1_1_g_s_object.html#a6b547741eeec4086de9abe227dae9325}{\texttt{applyShift(dx,
      dy)}} --- \emph{apply a $(dx, dy)$ shift to this object.}
\item[$\circ$]
  \href{http://galsim-developers.github.com/GalSim/classgalsim_1_1base_1_1_g_s_object.html#ae0b346a8b438dedbc7f60a52220869d8}{\texttt{obj.draw(...)}}
  --- \emph{draw an image of the \gsobject~using Discrete Fourier
  Transforms and interpolation to perform the image rendering.}
\item[$\circ$]
  \href{http://galsim-developers.github.com/GalSim/classgalsim_1_1base_1_1_g_s_object.html#a42ac334d2840ba3fa832988e998beca0}{\texttt{obj.drawShoot(...)}}
  --- \emph{draw an image of the \gsobject~by shooting a finite number of
  photons to perform the image rendering.  The resulting image
  therefore contains stochastic noise, but the rendering is otherwise
  very close to exact.}
\end{itemize}
Once again, for more information regarding each \gsobject~method,
the Python docstring is available

{\tt >>> print obj.<method\_name>.\_\_doc\_\_}

within the Python interpreter.  Alternatively follow the hyperlinks on
the class names above to view the \emph{doxygen} documentation based
on the Python docstrings.  You will see that many of the \gsobject
instances also have their own specialized methods, often for
retreiving parameter values. Examples are \texttt{obj.getSigma()} for
the Gaussian or \texttt{obj.getHalfLightRadius()} for many of the
\gsobject s.

\section{Random deviate classes and methods}\label{sect:random}
A short summary of the 8 random deviates currently implemented in GalSim,
with a short description of their distributions:
\begin{itemize}

\item[$\circ$] \texttt{UniformDeviate} --- \emph{uniform distribution in the
  interval $[0, 1)$.}

\item[$\circ$] \texttt{GaussianDeviate} --- \emph{Gaussian distribution
with \texttt{mean} and standard deviation \texttt{sigma}.}

\item[$\circ$] \texttt{BinomialDeviate} --- \emph{Binomial
    distribution for \texttt{N} trials each of probability \texttt{p}.}

\item[$\circ$] \texttt{PoissonDeviate} --- \emph{Poisson distribution
    with a single \texttt{mean} rate.}

\item[$\circ$] \texttt{CCDNoise}  --- \emph{Distribution following a
    basic CCD noise model, depending on \texttt{gain} and \texttt{read\_noise}.}

\item[$\circ$] \texttt{WeibullDeviate} --- \emph{Weibull distribution
    family (includes Rayleigh and Exponential) with shape parameters \texttt{a} and \texttt{b}.}

\item[$\circ$] \texttt{GammaDeviate} --- \emph{Gamma distribution for
    parameters \texttt{alpha} and \texttt{beta}.}

\item[$\circ$] \texttt{Chi2Deviate} --- \emph{$\chi^2$ distribution
    for degrees of freedom parameter \texttt{n}.}

\end{itemize}

Unfortunately the random deviate classes are not yet fully integrated within
the \emph{doxygen} documentation, due to their being C++ with compiled
Python wrappers.  This means that the class names above and methods
below are not
hyperlinked.

However, the full docstrings are available in
\texttt{galsim/random.py}, so please refer there for more information,
or type

{\tt >>> print galsim.<RandomDeviate\_name>.\_\_doc\_\_}

within the Python interpreter.

We now illustrate the most commonly-used methods of the random deviates.
If we assume that some random deviate instance 
has been instantiated as \texttt{dev},  for example

{\tt >>> dev = galsim.GaussianDeviate(sigma=3.9, mean=50.)},

The two most important and commonly-used methods for such an
instance are:
\begin{itemize}

\item[$\circ$] \texttt{dev.applyTo(image)} --- \emph{adds a deviate
  distributed according to the distribution represented by 
\texttt{dev} to each element in in a supplied Image instance \texttt{image} (see Section \ref{sect:image}).}

\item[$\circ$] \texttt{dev()} --- \emph{this direct call method
    returns a new random number drawn from the distribution
    represented by \texttt{dev}}.

\end{itemize}

\section{Image classes and methods}\label{sect:image}
The GalSim \texttt{Image}, classes store array data, pixel units and
image bounds information (origin, extent).  The \texttt{ImageView}
provides a mutable view into \texttt{Image} instance data, and
\texttt{ConstImageView} an immutable view into
\texttt{Image} instance data.  The full docstrings are available in
\texttt{galsim/image.py} with a description of the differences between
these fundamental types.

They are used to store the rendered output of the
\gsobject~\texttt{draw()} and \texttt{drawShoot()} methods, can be
operated on to add stochastic noise simulating real astronomical
images (e.g.\ Section \ref{sect:random}), and also have methods for
reading from and writing to FITS format output.

There are four types of GalSim \texttt{Image}, one for each of four
supported data types:
\begin{itemize}

\item[$\circ$] \texttt{ImageS}; \texttt{ImageViewS};
  \texttt{ConstImageViewS} --- \emph{for short integers (typically 16 bit).}

\item[$\circ$] \texttt{ImageI}; \texttt{ImageViewI};
  \texttt{ConstImageViewI} --- \emph{for integers (typically 32 bit).}

\item[$\circ$] \texttt{ImageF}; \texttt{ImageViewF};
  \texttt{ConstImageViewF} --- \emph{for single precision (typically 32 bit)
  floats.}

\item[$\circ$] \texttt{ImageD}; \texttt{ImageViewD};
  \texttt{ConstImageViewD} --- \emph{for double precision (typically 64 bit)
  floats.}

\end{itemize}
Unfortunately the \texttt{Image} classes are not yet fully integrated within
the \emph{doxygen} documentation, due to their being in C++ with compiled
Python wrappers.  This means that the class names above and methods below are not
hyperlinked.

However, the full docstrings are available in
\texttt{galsim/image.py}, so please refer there for more information,
or type

{\tt >>> print galsim.<ImageName>.\_\_doc\_\_}

within the Python interpreter.

We now illustrate the most commonly-used methods of \texttt{Image}
class instances.
We will assume that some image \texttt{img} 
has been instantiated. As an example:

{\tt im = obj.draw(dx=1.)}.

The most important and commonly-used methods for such an
instance are:
\begin{itemize}

\item[$\circ$] \texttt{img.addNoise(dev)} --- (see
  \texttt{galsim/noise.py}) this adds stochastic noise, distributed as
  represented by the random deviate instance \texttt{dev}, to image
  element of the image \texttt{img}.  This therefore has the same
  effect as \texttt{dev.applyTo(img)} (see Section \ref{sect:random}).

\item[$\circ$] \texttt{img.write(image, fits, ...)}  ---  (see
  \texttt{galsim/fits.py})\emph{write the \texttt{image} to a FITS
    file or object as determined by the \texttt{fits} input parameter.}

\item[$\circ$] \texttt{img.writeMulti(image\_list, fits, ...)} ---   (see
  \texttt{galsim/fits.py}) \emph{write multiple images stored in a
  Python list object \texttt{image\_list} to a Multi-Extension FITS
  file or object as determined by the \texttt{fits} input parameter.}

\item[$\circ$] \texttt{img.writeCube(image\_list, fits...)} ---   (see
  \texttt{galsim/fits.py}) \emph{write multiple images stored in a
  Python list object \texttt{image\_list} to a three-dimensional FITS
  datacube object as determined by the \texttt{fits} input parameter.}

\end{itemize}

\section{Miscellaneous classes and methods}\label{sect:misc}

\begin{itemize}

\item[$\circ$] \texttt{Angle} --- TODO: Find a good description of the
  working of the Angle class and put it here.

\item[$\circ$] \href{http://galsim-developers.github.com/GalSim/classgalsim_1_1ellipse_1_1_ellipse.html}{\texttt{Ellipse}} --- (see \texttt{galsim/ellipse.py})
  class to represent ellipses and thus ellipse-type transformations.  
The class can be initialized using a variety of differing parameter conventions.

\end{itemize}

\end{document}
